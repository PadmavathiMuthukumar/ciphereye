<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CipherEye IDS Dashboard</title>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 20px;
            background: #f4f6f8;
            color: #333;
        }
        .header {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        .stat-card {
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .stat-card.total { background: #e3f2fd; }
        .stat-card.benign { background: #e8f5e9; }
        .stat-card.malicious { background: #ffebee; }
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
        }
        button.start { background: #4caf50; color: white; }
        button.stop { background: #f44336; color: white; }
        button:hover { opacity: 0.9; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: white;
        }
        th, td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background: #f5f5f5;
            font-weight: 600;
        }
        tr:nth-child(even) { background: #fafafa; }
        .benign { color: #2e7d32; }
        .malicious { color: #c62828; }
        .status-bar {
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-weight: 500;
        }
        .status-bar.connected { background: #e8f5e9; color: #2e7d32; }
        .status-bar.disconnected { background: #ffebee; color: #c62828; }
        .status-bar.error { background: #fff3e0; color: #e65100; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ÔøΩÔ∏è CipherEye IDS Dashboard</h1>
        <p>Real-time Network Traffic Analysis</p>
        <div id="connection-status" class="status-bar"></div>
    </div>

    <div class="controls">
        <button id="startBtn" class="start">Start Capture</button>
        <button id="stopBtn" class="stop" disabled>Stop Capture</button>
    </div>

    <div class="dashboard-grid">
        <div class="card">
            <h2>üìä Traffic Statistics</h2>
            <div class="stats">
                <div class="stat-card total">
                    <h3>Total</h3>
                    <div id="total-packets">0</div>
                </div>
                <div class="stat-card benign">
                    <h3>Benign</h3>
                    <div id="benign-packets">0</div>
                </div>
                <div class="stat-card malicious">
                    <h3>Malicious</h3>
                    <div id="malicious-packets">0</div>
                </div>
            </div>
            <canvas id="trafficChart"></canvas>
        </div>

        <div class="card">
            <h2>üîç Latest Packets</h2>
            <table id="packetTable">
                <thead>
                    <tr>
                        <th>Size</th>
                        <th>SYN</th>
                        <th>ACK</th>
                        <th>FIN</th>
                        <th>PSH</th>
                        <th>Classification</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        // Initialize socket connection
        const socket = io({
            transports: ['websocket', 'polling'],
            reconnection: true,
            reconnectionDelay: 1000,
            reconnectionDelayMax: 5000,
            reconnectionAttempts: Infinity
        });
        let chart = null;
        
        // Debug socket connection
        socket.on('connect_error', (error) => {
            console.error('Connection error:', error);
            document.getElementById('connection-status').className = 'status-bar error';
            document.getElementById('connection-status').textContent = '‚ö†Ô∏è Connection error: ' + error.message;
        });

        // Connection handling
        socket.on('connect', () => {
            document.getElementById('connection-status').className = 'status-bar connected';
            document.getElementById('connection-status').textContent = '‚úÖ Connected to server';
        });

        socket.on('disconnect', () => {
            document.getElementById('connection-status').className = 'status-bar disconnected';
            document.getElementById('connection-status').textContent = '‚ùå Disconnected from server';
        });

        // Initialize Chart
        function initChart() {
            const ctx = document.getElementById('trafficChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Benign', 'Malicious'],
                    datasets: [{
                        data: [0, 0],
                        backgroundColor: ['#4caf50', '#f44336'],
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        initChart();

        // Handle packet data updates
        socket.on('packet_data', (data) => {
            // Update statistics
            document.getElementById('total-packets').textContent = data.stats.total;
            document.getElementById('benign-packets').textContent = data.stats.benign;
            document.getElementById('malicious-packets').textContent = data.stats.malicious;

            // Update chart
            chart.data.datasets[0].data = [data.stats.benign, data.stats.malicious];
            chart.update();

            // Update packet table
            const tbody = document.querySelector('#packetTable tbody');
            tbody.innerHTML = data.packets.map(pkt => `
                <tr>
                    <td>${pkt.size}</td>
                    <td>${pkt.syn}</td>
                    <td>${pkt.ack}</td>
                    <td>${pkt.fin}</td>
                    <td>${pkt.psh}</td>
                    <td class="${pkt.label.toLowerCase()}">${pkt.label}</td>
                </tr>
            `).join('');
        });

        // Handle capture status updates
        socket.on('capture_status', (data) => {
            if (data.status === 'started') {
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
                document.getElementById('connection-status').textContent = 
                    `‚úÖ Capturing packets on interface: ${data.interface}`;
            } else if (data.status === 'stopped') {
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
                document.getElementById('connection-status').textContent = 
                    '‚è∏Ô∏è Packet capture stopped';
            }
        });

        // Handle errors
        socket.on('capture_error', (data) => {
            document.getElementById('connection-status').className = 'status-bar error';
            document.getElementById('connection-status').textContent = 
                `‚ö†Ô∏è Error: ${data.error}`;
        });

        // Button event handlers
        document.getElementById('startBtn').addEventListener('click', () => {
            socket.emit('start_capture');
        });

        document.getElementById('stopBtn').addEventListener('click', () => {
            socket.emit('stop_capture');
        });

        // Auto-start capture when page loads
        setTimeout(() => {
            socket.emit('start_capture');
        }, 1000);  // Wait 1 second after page load

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            socket.emit('stop_capture');
            socket.disconnect();
        });
    </script>
</body>
</html>
